<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aseng.AI - Chat Assistant</title>
   <style>
:root {
    --bg-color: #0f172a;
    --card-bg: #1e293b;
    --text-main: #f8fafc;
    --text-muted: #94a3b8;
    --accent: #10b981;
    --user-bubble: #10b981;
    --ai-bubble: #334155;
    --input-bg: #0f172a;
    --error-color: #ef4444;
    --sidebar-bg: #0f172a;
    --sidebar-active: #10b981;
}

.light-mode {
    --bg-color: #f1f5f9;
    --card-bg: #ffffff;
    --text-main: #1e293b;
    --text-muted: #64748b;
    --accent: #059669;
    --user-bubble: #059669;
    --ai-bubble: #e2e8f0;
    --input-bg: #f8fafc;
    --sidebar-bg: #ffffff;
    --sidebar-active: #059669;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Inter', sans-serif;
    -webkit-tap-highlight-color: transparent;
}

html, body {
    width: 100%;
    height: 100%;
    overflow: hidden;
    background-color: var(--bg-color);
    transition: background 0.3s ease;
}

#app-container {
    width: 100vw;
    height: 100dvh;
    display: flex;
    position: fixed;
    top: 0;
    left: 0;
}

/* Sidebar */
#sidebar {
    width: 280px;
    background-color: var(--sidebar-bg);
    border-right: 1px solid rgba(255, 255, 255, 0.05);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    z-index: 100;
}

.sidebar-header {
    padding: 24px 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.brand {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--accent);
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
}

.brand::before {
    content: "ðŸ¤–";
    font-size: 1.8rem;
}

.new-chat-btn {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, var(--accent), #059669);
    color: white;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s;
    font-size: 1rem;
}

.new-chat-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
}

#chat-history {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
}

.history-item {
    padding: 14px 16px;
    margin-bottom: 8px;
    border-radius: 10px;
    cursor: pointer;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    border: 1px solid transparent;
    transition: all 0.2s;
}

.history-item:hover {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-main);
}

.history-item.active {
    background: rgba(16, 185, 129, 0.1);
    color: var(--accent);
    border-color: var(--accent);
}

/* Main Chat Area */
#main-chat {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    height: 100%;
}

.chat-header {
    padding: 20px 24px;
    background-color: var(--card-bg);
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    flex-shrink: 0;
    min-height: 80px;
    position: sticky;
    top: 0;
    z-index: 50;
}

.chat-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text-main);
}

.mobile-menu-btn {
    display: none;
    background: none;
    border: none;
    color: var(--text-muted);
    padding: 8px;
    cursor: pointer;
}

.controls {
    display: flex;
    gap: 12px;
}

.icon-btn {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    padding: 10px;
    border-radius: 10px;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
}

.icon-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    color: var(--text-main);
    transform: translateY(-2px);
}

#chat-area {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    scroll-behavior: smooth;
    min-height: 0;
}

/* Custom scrollbar */
#chat-area::-webkit-scrollbar,
#chat-history::-webkit-scrollbar {
    width: 6px;
}

#chat-area::-webkit-scrollbar-track,
#chat-history::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 3px;
}

#chat-area::-webkit-scrollbar-thumb,
#chat-history::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 3px;
}

.message {
    max-width: 85%;
    padding: 14px 18px;
    border-radius: 18px;
    font-size: 0.95rem;
    line-height: 1.5;
    animation: fadeIn 0.3s ease-out forwards;
    white-space: pre-wrap;
    word-wrap: break-word;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

@keyframes fadeIn {
    from { 
        opacity: 0; 
        transform: translateY(10px); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0); 
    }
}

.user-msg {
    align-self: flex-end;
    background: linear-gradient(135deg, var(--user-bubble), #059669);
    color: white;
    border-bottom-right-radius: 4px;
}

.ai-msg {
    align-self: flex-start;
    background-color: var(--ai-bubble);
    color: var(--text-main);
    border-bottom-left-radius: 4px;
    border: 1px solid rgba(255, 255, 255, 0.05);
}

.error-msg {
    align-self: center;
    background-color: rgba(239, 68, 68, 0.1);
    color: var(--error-color);
    font-size: 0.85rem;
    border: 1px solid var(--error-color);
    border-radius: 10px;
    max-width: 90%;
    text-align: center;
    padding: 12px 20px;
}

.typing {
    display: flex;
    gap: 6px;
    padding: 16px 20px;
    background: var(--ai-bubble);
    border-radius: 18px;
    align-self: flex-start;
    margin-bottom: 16px;
    border: 1px solid rgba(255, 255, 255, 0.05);
}

.dot {
    width: 8px;
    height: 8px;
    background: var(--accent);
    border-radius: 50%;
    animation: bounce 1.4s infinite ease-in-out;
}

.dot:nth-child(2) { animation-delay: 0.2s; }
.dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes bounce {
    0%, 80%, 100% { transform: scale(0); }
    40% { transform: scale(1); }
}

.input-container {
    padding: 20px;
    background-color: var(--card-bg);
    border-top: 1px solid rgba(255, 255, 255, 0.05);
    flex-shrink: 0;
    position: sticky;
    bottom: 0;
    z-index: 50;
}

.input-wrapper {
    background-color: var(--input-bg);
    border-radius: 16px;
    padding: 4px 8px;
    display: flex;
    align-items: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s;
}

.input-wrapper:focus-within {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
}

#user-input {
    flex: 1;
    background: none;
    border: none;
    padding: 14px;
    color: var(--text-main);
    outline: none;
    font-size: 0.95rem;
    min-height: 24px;
    max-height: 120px;
    resize: none;
    font-family: inherit;
}

#user-input::placeholder {
    color: var(--text-muted);
}

#send-btn {
    background: linear-gradient(135deg, var(--accent), #059669);
    color: white;
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 12px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.2s;
    flex-shrink: 0;
}

#send-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
}

#send-btn:active:not(:disabled) {
    transform: translateY(0);
}

#send-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: var(--text-muted);
}

.welcome-msg {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-muted);
    font-size: 0.95rem;
    animation: fadeIn 0.5s ease-out;
    max-width: 600px;
    margin: 0 auto;
}

.welcome-msg h3 {
    color: var(--accent);
    margin-bottom: 12px;
    font-size: 1.4rem;
}

.hidden { 
    display: none !important; 
}

/* Responsive untuk mobile */
@media (max-width: 768px) {
    #sidebar {
        position: fixed;
        left: -280px;
        top: 0;
        height: 100%;
        transition: left 0.3s ease;
        z-index: 1000;
    }
    
    #sidebar.active {
        left: 0;
    }
    
    .mobile-menu-btn {
        display: block;
    }
    
    .chat-header {
        padding: 16px 20px;
        min-height: 70px;
    }
    
    .brand {
        font-size: 1.3rem;
    }
    
    #chat-area {
        padding: 16px;
        gap: 12px;
    }
    
    .message {
        max-width: 92%;
        padding: 12px 16px;
        font-size: 0.9rem;
    }
    
    .input-container {
        padding: 16px;
    }
    
    #user-input {
        padding: 12px;
        font-size: 0.9rem;
    }
    
    #send-btn {
        width: 40px;
        height: 40px;
    }
    
    .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
    }
    
    .overlay.active {
        display: block;
    }
}

@media (max-width: 480px) {
    .message {
        max-width: 95%;
        padding: 10px 14px;
        font-size: 0.85rem;
    }
    
    .chat-title {
        font-size: 1rem;
    }
    
    .welcome-msg {
        padding: 30px 16px;
    }
    
    .welcome-msg h3 {
        font-size: 1.2rem;
    }
}

/* Fix untuk keyboard mobile */
@media (max-height: 700px) {
    #chat-area {
        padding: 12px;
        max-height: calc(100vh - 180px);
    }
    
    .input-container {
        padding: 12px;
    }
    
    #main-chat {
        height: auto;
        min-height: 100vh;
    }
}

/* Fix untuk iOS Safari */
@supports (-webkit-touch-callout: none) {
    #app-container {
        height: -webkit-fill-available;
    }
    
    #main-chat {
        height: -webkit-fill-available;
    }
}

/* Untuk browser yang support dvh */
@supports (height: 100dvh) {
    #app-container {
        height: 100dvh;
    }
}

/* Smooth transition untuk tema */
.theme-transition * {
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}
   </style>
</head>
<body>

<div id="app-container" class="theme-transition">
    <!-- Sidebar -->
    <div id="sidebar">
        <div class="sidebar-header">
            <div class="brand">Aseng.AI</div>
            <button class="new-chat-btn" id="new-chat-btn">
                <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path>
                </svg>
                Chat Baru
            </button>
        </div>
        
        <div id="chat-history">
            <!-- Daftar chat akan diisi oleh JavaScript -->
        </div>
    </div>

    <!-- Overlay untuk mobile -->
    <div class="overlay" id="sidebar-overlay"></div>

    <!-- Main Chat Area -->
    <div id="main-chat">
        <div class="chat-header">
            <button class="mobile-menu-btn" id="mobile-menu-btn">
                <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
            
            <div class="chat-title" id="current-chat-title">Chat Baru</div>
            
            <div class="controls">
                <button class="icon-btn" id="theme-toggle" title="Ganti Tema">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                    </svg>
                </button>
                <button class="icon-btn" id="clear-btn" title="Hapus Chat Ini">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                </button>
            </div>
        </div>

        <div id="chat-area"></div>

        <div class="typing hidden" id="typing-indicator">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>

        <div class="input-container">
            <form id="chat-form" class="input-wrapper">
                <textarea id="user-input" placeholder="Tulis pesan..." rows="1"></textarea>
                <button type="submit" id="send-btn">
                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                </button>
            </form>
        </div>
    </div>
</div>

<script>
    // Konfigurasi
    const apiKey = "AIzaSyARZF0a8ytWcrTi9pYf7H_GgBNzgm55Q8c"; // Ganti dengan API key Gemini Anda
    
    // DOM Elements
    const appContainer = document.getElementById('app-container');
    const sidebar = document.getElementById('sidebar');
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const newChatBtn = document.getElementById('new-chat-btn');
    const chatHistoryContainer = document.getElementById('chat-history');
    const chatArea = document.getElementById('chat-area');
    const chatForm = document.getElementById('chat-form');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const typingIndicator = document.getElementById('typing-indicator');
    const clearBtn = document.getElementById('clear-btn');
    const themeToggle = document.getElementById('theme-toggle');
    const currentChatTitle = document.getElementById('current-chat-title');

    // State management
    let chats = new Map(); // key: chatId, value: { title, messages }
    let currentChatId = null;
    let nextChatId = 1;

    // Initialize
    window.addEventListener('DOMContentLoaded', () => {
        // Load saved data
        loadChats();
        loadTheme();
        
        // Auto-resize textarea
        userInput.addEventListener('input', autoResizeTextarea);
        
        // Focus input
        setTimeout(() => userInput.focus(), 100);
        
        // Handle mobile menu
        mobileMenuBtn.addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', closeSidebar);
        
        // Handle window resize untuk mobile
        window.addEventListener('resize', handleResize);
        handleResize(); // Initial check
    });

    // Auto-resize textarea
    function autoResizeTextarea() {
        userInput.style.height = 'auto';
        const newHeight = Math.min(userInput.scrollHeight, 120);
        userInput.style.height = newHeight + 'px';
    }

    // Handle mobile sidebar
    function toggleSidebar() {
        sidebar.classList.toggle('active');
        sidebarOverlay.classList.toggle('active');
    }

    function closeSidebar() {
        sidebar.classList.remove('active');
        sidebarOverlay.classList.remove('active');
    }

    // Handle window resize
    function handleResize() {
        if (window.innerWidth > 768) {
            sidebar.classList.remove('active');
            sidebarOverlay.classList.remove('active');
        }
    }

    // Load saved chats
    function loadChats() {
        const saved = localStorage.getItem('asengai_chats');
        if (saved) {
            const parsed = JSON.parse(saved);
            chats = new Map(parsed.chats);
            nextChatId = parsed.nextChatId || 1;
            currentChatId = parsed.currentChatId || null;
            
            renderChatHistory();
            
            if (currentChatId && chats.has(currentChatId)) {
                renderChat(currentChatId);
            } else {
                createNewChat();
            }
        } else {
            createNewChat();
        }
    }

    // Save chats to localStorage
    function saveChats() {
        const data = {
            chats: Array.from(chats.entries()),
            nextChatId: nextChatId,
            currentChatId: currentChatId
        };
        localStorage.setItem('asengai_chats', JSON.stringify(data));
    }

    // Create new chat
    function createNewChat() {
        const chatId = `chat_${nextChatId++}`;
        const title = `Chat ${nextChatId - 1}`;
        
        chats.set(chatId, {
            title: title,
            messages: []
        });
        
        currentChatId = chatId;
        renderChatHistory();
        renderChat(chatId);
        saveChats();
        
        // Close sidebar on mobile
        if (window.innerWidth <= 768) {
            closeSidebar();
        }
    }

    // Render chat history in sidebar
    function renderChatHistory() {
        chatHistoryContainer.innerHTML = '';
        
        chats.forEach((chat, chatId) => {
            const historyItem = document.createElement('div');
            historyItem.className = `history-item ${chatId === currentChatId ? 'active' : ''}`;
            historyItem.textContent = chat.title;
            historyItem.title = chat.title;
            
            historyItem.addEventListener('click', () => {
                switchToChat(chatId);
            });
            
            chatHistoryContainer.appendChild(historyItem);
        });
    }

    // Switch to specific chat
    function switchToChat(chatId) {
        currentChatId = chatId;
        renderChatHistory();
        renderChat(chatId);
        saveChats();
        
        // Close sidebar on mobile
        if (window.innerWidth <= 768) {
            closeSidebar();
        }
    }

    // Render chat messages
    function renderChat(chatId) {
        const chat = chats.get(chatId);
        if (!chat) return;
        
        chatArea.innerHTML = '';
        currentChatTitle.textContent = chat.title;
        
        if (chat.messages.length === 0) {
            showWelcomeMessage();
        } else {
            chat.messages.forEach(msg => {
                addMessageToDOM(msg.text, msg.sender, false);
            });
            chatArea.scrollTop = chatArea.scrollHeight;
        }
    }

    // Welcome message
    function showWelcomeMessage() {
        const welcomeDiv = document.createElement('div');
        welcomeDiv.className = 'welcome-msg';
        welcomeDiv.innerHTML = `
            <h3>ðŸ¤– Selamat Datang di Aseng.AI</h3>
            <p>Saya adalah asisten AI cerdas yang siap membantu Anda!</p>
            <p style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">
                Mulai percakapan dengan mengetik pesan di bawah.<br>
                Saya bisa membantu dengan berbagai topik!
            </p>
        `;
        chatArea.appendChild(welcomeDiv);
    }

    // Handle form submit
    chatForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const msg = userInput.value.trim();
        if (!msg) return;

        // Remove welcome message if present
        const welcomeMsg = document.querySelector('.welcome-msg');
        if (welcomeMsg) {
            welcomeMsg.remove();
        }

        // Auto-generate chat title jika chat baru
        if (currentChatId) {
            const chat = chats.get(currentChatId);
            if (chat.messages.length === 0 && chat.title.startsWith('Chat ')) {
                const newTitle = msg.length > 30 ? msg.substring(0, 30) + '...' : msg;
                chat.title = newTitle;
                currentChatTitle.textContent = newTitle;
                renderChatHistory();
            }
        }

        // Add user message
        addMessage(msg, 'user');
        userInput.value = '';
        autoResizeTextarea();
        userInput.disabled = true;
        sendBtn.disabled = true;
        showTyping(true);

        try {
            // Clean the message from markdown symbols
            const cleanMessage = cleanMarkdownSymbols(msg);
            const responseText = await fetchGeminiResponse(cleanMessage);
            showTyping(false);
            
            // Clean AI response from markdown symbols
            const cleanResponse = cleanMarkdownSymbols(responseText);
            addMessage(cleanResponse, 'ai');
        } catch (error) {
            console.error('Error:', error);
            showTyping(false);
            addMessage("Maaf, terjadi kesalahan. Silakan coba lagi.", 'error');
        } finally {
            userInput.disabled = false;
            sendBtn.disabled = false;
            userInput.focus();
        }
    });

    // Clean markdown symbols
    function cleanMarkdownSymbols(text) {
        if (!text) return text;
        
        // Remove common markdown symbols
        return text
            .replace(/\*\*/g, '')        // Remove **bold**
            .replace(/\*/g, '')          // Remove *italics*
            .replace(/__/g, '')          // Remove __underline__
            .replace(/~~/g, '')          // Remove ~~strikethrough~~
            .replace(/^#{1,6}\s+/gm, '') // Remove headers
            .replace(/`{3}[\s\S]*?`{3}/g, '') // Remove code blocks
            .replace(/`([^`]+)`/g, '$1') // Remove inline code
            .replace(/\[([^\]]+)\]\([^)]+\)/g, '$1') // Remove links
            .replace(/^\s*[-*+]\s+/gm, 'â€¢ ') // Convert lists to simple bullets
            .replace(/^\s*\d+\.\s+/gm, '') // Remove numbered lists
            .replace(/\n{3,}/g, '\n\n')  // Remove excessive newlines
            .trim();
    }

    // API Call
    async function fetchGeminiResponse(prompt, retries = 3, delay = 1000) {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
        
        const payload = {
            contents: [{ parts: [{ text: prompt }] }],
            systemInstruction: { 
                parts: [{ text: "Kamu adalah Aseng.AI, asisten AI yang ramah dan membantu. Gunakan bahasa Indonesia yang natural. JANGAN GUNAKAN format markdown seperti **, *, `, atau simbol lainnya. Gunakan kalimat biasa saja tanpa format khusus." }] 
            }
        };

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                if (response.status === 429 && retries > 0) {
                    await new Promise(res => setTimeout(res, delay));
                    return fetchGeminiResponse(prompt, retries - 1, delay * 2);
                }
                throw new Error(`Error ${response.status}`);
            }

            const data = await response.json();
            return data.candidates?.[0]?.content?.parts?.[0]?.text || "Maaf, tidak ada respon.";
        } catch (error) {
            if (retries > 0) {
                await new Promise(res => setTimeout(res, delay));
                return fetchGeminiResponse(prompt, retries - 1, delay * 2);
            }
            throw error;
        }
    }

    // Add message to chat
    function addMessage(text, sender) {
        // Add to DOM
        addMessageToDOM(text, sender, true);
        
        // Save to current chat
        if (currentChatId) {
            const chat = chats.get(currentChatId);
            if (chat) {
                chat.messages.push({ text, sender });
                saveChats();
            }
        }
    }

    // Add message to DOM
    function addMessageToDOM(text, sender, scroll = true) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `message ${sender}-msg`;
        msgDiv.textContent = text;
        chatArea.appendChild(msgDiv);
        
        if (scroll) {
            chatArea.scrollTop = chatArea.scrollHeight;
        }
    }

    // Show typing indicator
    function showTyping(show) {
        if (show) {
            typingIndicator.classList.remove('hidden');
            chatArea.appendChild(typingIndicator);
            chatArea.scrollTop = chatArea.scrollHeight;
        } else {
            typingIndicator.classList.add('hidden');
        }
    }

    // Event Listeners
    newChatBtn.addEventListener('click', createNewChat);

    clearBtn.addEventListener('click', () => {
        if (currentChatId && confirm("Hapus percakapan ini?")) {
            const chat = chats.get(currentChatId);
            if (chat) {
                chat.messages = [];
                chat.title = `Chat ${currentChatId.split('_')[1]}`;
                currentChatTitle.textContent = chat.title;
                renderChatHistory();
                renderChat(currentChatId);
                saveChats();
            }
        }
    });

    themeToggle.addEventListener('click', () => {
        document.body.classList.toggle('light-mode');
        const isLightMode = document.body.classList.contains('light-mode');
        localStorage.setItem('asengai_theme', isLightMode ? 'light' : 'dark');
    });

    // Load theme preference
    function loadTheme() {
        if (localStorage.getItem('asengai_theme') === 'light') {
            document.body.classList.add('light-mode');
        }
    }

    // Handle Enter key untuk submit (Shift+Enter untuk new line)
    userInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            chatForm.dispatchEvent(new Event('submit'));
        }
    });

    // Fokus otomatis ke input
    chatArea.addEventListener('click', () => {
        userInput.focus();
    });
</script>

</body>
</html>
